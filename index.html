<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <title>Richard's Webpage</title>
  <meta name="viewport" content="width=960">
  <meta name="keywords" content="google,bouncing balls,html5" />
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
  <script src="./dataURI.js"></script>
  <link href="main.css" rel="stylesheet">
  <!--[if IE]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
  <noscript><h1>We need javascript to view my page.</h1></noscript>
  <canvas id="c" onmousemove="mouse_moved(event)"></canvas>
  
  <script>
    // Page Canvas
    var canvas = document.getElementById('c');
    var context = canvas.getContext('2d');
    var dataURL = "0";

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    var img = new Image;
    img.onload = function(){
      context.drawImage(img, (canvas.width-img.width)/2, (canvas.height-img.height)/2);
    };
    img.src = dataURI;

    // Temporary Drawing Canvas
    var tempCanvas = document.createElement("canvas");
    var tCtx = tempCanvas.getContext("2d");

    tempCanvas.width = 100;
    tempCanvas.height = 100;

    // Keeping Track of Mouse Position 
    var x = 100;
    var y = 100;

    function mouse_moved(event) {
      x = event.clientX;
      y = event.clientY;
    }

    // Posting every second
    setInterval(function() {
      // method to be executed;
      // style_it(canvas.toDataURL());
      var start_x = x-50;
      var start_y = y-50;
      console.log(start_x + " " + start_y);
      var crop = get_crop(start_x, start_y);
      style_it(crop, start_x, start_y);
    }, 1000);

    // Getting a Crop from the Canvas
    function get_crop(oldx, oldy) {
      //call its drawImage() function passing it the source canvas directly
      tCtx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
      tCtx.drawImage(canvas, -oldx, -oldy);
      return tempCanvas.toDataURL();
    }

    // Style Request
    function style_it(image, oldx, oldy){
        $.ajax({
         startx : oldx,
         starty : oldy,
         type : "POST",
         url  : "http://52.42.5.250:2424",
         data : { "image": image }, 
         error: function(xhr, error){
                console.debug(xhr);
                console.debug(error);
         },
         success: function(result) { 
            console.log("new image");
            var img = document.createElement('img');
            img.src = 'data:image/jpeg;base64,' + result;
            context.drawImage(img, this.startx, this.starty);
         }
        });
    }
</script>
</body>
</html>
